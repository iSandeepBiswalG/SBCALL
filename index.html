<!DOCTYPE html>
<html lang="en">
<!--
  WARNING: Do not download, sell, or distribute the SB Video Call Web App.
  This project is free and cannot be copied or sold.
  Unauthorized use, reproduction, or distribution is illegal and violates the terms of use.
  Respect the developers' work and ensure the app is used responsibly and ethically.
  instagram : @sandeepbiswlg
-->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Primary Meta Tags -->
<title>SB Video Call</title>
<meta name="title" content="SB Video Call – Free, Fast & Secure Browser-Based Video Calling">
<meta name="description" content="Experience high-quality video calls directly from your browser with SB Video Call. No downloads, just share and start chatting instantly – private, secure, and simple.">

<!-- SEO Meta Tags -->
<meta name="keywords" content="SB Video Call, free video call, browser video chat, video call without app, online meeting, secure video call, free video call, peer-to-peer, peer to peer, peer to peer video call">
<meta name="robots" content="index, follow">
<meta name="author" content="Sandeep Biswal G">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://sbcall.netlify.app/">
<meta property="og:title" content="SB Video Call – Free, Fast & Secure Browser-Based Video Calling">
<meta property="og:description" content="No app needed – connect instantly with secure video calls using SB Video Call.">
<meta property="og:image" content="https://sbcall.netlify.app/images/eng.png">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://sbcall.netlify.app/">
<meta name="twitter:title" content="SB Video Call – Free, Fast & Secure Browser-Based Video Calling">
<meta name="twitter:description" content="Free, app-less video calls in your browser. Connect in seconds with SB Video Call – fast, simple, and private.">
<meta name="twitter:image" content="https://sbcall.netlify.app/images/eng.png">

  <!-- Social Media -->
<meta property="og:see_also" content="https://www.facebook.com/sandeepbiswalg">
<meta property="og:see_also" content="https://x.com/sandeepbiswalg">
<meta property="og:see_also" content="https://instagram.com/sandeepbiswalg">
<meta property="og:see_also" content="https://youtube.com/sandeepbiswalg">


 <link rel="manifest" href="/manifest.json">
<link rel="icon" href="https://raw.githubusercontent.com/iSandeepBiswalG/SBCALL/refs/heads/main/sbg/sbg.ico" type="image/x-icon">
<meta name="theme-color" content="#313338">

<!-- iOS Specific -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="SB Video Call">
<link rel="apple-touch-icon" href="https://raw.githubusercontent.com/iSandeepBiswalG/SBCALL/refs/heads/main/sbg/sbg.ico">

  <link rel="icon" href="/sbg/sbg.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/sbg/sbg.ico" type="image/x-icon">

    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Oriya:wdth,wght@88,100..900&display=swap" rel="stylesheet">
 <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "https://sbcall.netlify.app/#website",
      "url": "https://sbcall.netlify.app/",
      "name": [
        {
          "@value": "SB Video Call",
          "@language": "en"
        },
        {
          "@value": "ଏସ୍‌ବି ଭିଡିଓ କଲ୍",
          "@language": "or"
        }
      ],
      "alternateName": [
        {
          "@value": "SB Call",
          "@language": "en"
        },
        {
          "@value": "SB କଲ୍",
          "@language": "or"
        }
      ],
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://sbcall.netlify.app/search?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
  ]
}
</script>
    <style>
        /* --- Enhanced Video Call UI --- */

        /* Reset and Base Styles */
        :root {
            --background-dark: #1e1f22; /* Very dark grey */
            --background-medium: #2b2d31; /* Medium dark grey (video backgrounds, controls bg) */
            --background-light: #313338; /* Lighter dark grey (navbar, some controls) */
            --accent-purple: #6c5ce7; /* Vibrant purple */
            --accent-purple-hover: #8a7dfa;
            --text-primary: #f2f3f5; /* Off-white */
            --text-secondary: #b5bac1; /* Greyish */
            --border-color: #404249;
            --red-leave: #e74c3c; /* Red for leave/off state */
            --red-leave-hover: #c0392b;
            --green-on: #2ecc71; /* Green for 'on' state (optional) */
            --control-icon-size: 18px;
            --copy-icon-size: 16px;
            --copy-feedback-color: var(--green-on);
        }

        body {
            font: bold 16px/1.5 "Noto Sans Oriya", sans-serif;
            background-color: var(--background-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* App content wrapper - visible by default */
        #app-content {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            /* min-height is handled by body if #app-content is the main child */
        }


        /* Navbar (Top Bar Simulation) */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Space between SB ID group and hidden video */
            padding: 12px 25px;
            background-color: var(--background-light);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .peer-id-container {
            display: flex;
            align-items: center;
            gap: 10px; /* Space between ID and copy button */
            flex-grow: 1; /* Allow it to take available space */
            min-width: 0; /* Allow shrinking */
        }

        /* Peer ID Display (Top Bar Info) */
        h3#show-peer {
            margin: 0;
            padding: 8px 12px; /* Slightly less padding */
            border: 1px solid var(--border-color);
            background-color: var(--background-medium);
            color: var(--text-secondary);
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
            text-align: left;
            overflow-wrap: break-word;
            white-space: nowrap;      /* Prevent wrapping initially */
            overflow: hidden;         /* Hide overflow */
            text-overflow: ellipsis;  /* Add ellipsis */
            max-width: 250px; /* Limit max width */
            flex-shrink: 1; /* Allow shrinking if needed */
        }

        /* Copy Button */
        #copy-peer-id {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        #copy-peer-id:hover {
            background-color: var(--background-medium);
            color: var(--text-primary);
        }

        #copy-peer-id svg {
            width: var(--copy-icon-size);
            height: var(--copy-icon-size);
            fill: currentColor;
        }

        #copy-peer-id.copied svg {
             fill: var(--copy-feedback-color); /* Green check */
        }


        /* Local Video Container (Hidden in Navbar flow, positioned absolutely later) */
        .navbar .video1 {
            width: 0;
            height: 0;
            margin: 0;
            padding: 0;
            border: none;
            box-shadow: none;
            background-color: transparent;
            flex-shrink: 0; /* Don't let it shrink */
        }

        /* Container FOR the Local Video (Picture-in-Picture) */
        #ourVideo {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 160px;
            height: 120px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--background-medium);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s ease; /* For camera off fade */
        }
         /* Style for when camera is off */
        #ourVideo.camera-off video {
            opacity: 0; /* Hide the video feed */
        }
        #ourVideo.camera-off::before { /* Show icon when camera off */
            content: '';
            display: block;
            width: 40px;
            height: 40px;
            background-color: var(--text-secondary); /* Icon color */
            mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video-off-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M10.961 12.365a1.99 1.99 0 0 0 .522-1.103l3.11 1.382A.5.5 0 0 0 15 12.197V3.803a.5.5 0 0 0-.407-.498l-3.11 1.382A2 2 0 0 0 9.5 3H4.272l6.69 9.365z"/><path d="M2.41 1.033a.5.5 0 0 0-.683-.066L.379 2.68A.5.5 0 0 0 .173 3H.5a.5.5 0 0 0 .5.5v7a.5.5 0 0 0 .5.5h6.472L11.59 15.4a.5.5 0 0 0 .825-.37l.02-.002.442-1.106a.5.5 0 0 0-.066-.683L2.41 1.033z"/></svg>');
            mask-size: contain;
            mask-repeat: no-repeat;
            mask-position: center;
            opacity: 0.7;
        }

        /* Local Video Element Styling (added by JS) */
        .ourvideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            margin: 0;
            border-radius: 0;
            transform: scaleX(-1); /* Mirror effect */
            transition: opacity 0.3s ease;
        }

        /* Main Content Section */
        .section1 {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 25px;
            position: relative; /* Needed for absolute positioning of #ourVideo */
        }

        /* Remote Video Container */
        #remoteVideo {
            width: 100%;
            max-width: 1000px;
            aspect-ratio: 16 / 9;
            background-color: var(--background-medium);
            border: none;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            margin: 0;
            height: auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Remote Video Element Styling (added by JS) */
        #remoteVideo .video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            border-radius: 0;
            margin: 0;
        }

        /* Controls Area (Bottom Bar) */
        .controls { /* Renamed .btn to .controls for clarity */
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px 25px;
            background-color: var(--background-light); /* Match top bar */
            margin: 0;
            border-top: 1px solid var(--border-color);
        }

        /* Input Field Styling */
        .controls input#peerID {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9em;
            background-color: var(--background-medium); /* Darker input bg */
            color: var(--text-primary);
            flex-grow: 1; /* Allow input to grow */
            max-width: 250px; /* Limit input width */
            height: auto;
            margin: 0;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            outline: none;
        }

        .controls input#peerID::placeholder {
            color: var(--text-secondary);
        }

        .controls input#peerID:focus {
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.3);
        }

        /* General Button Styling */
        .controls button {
            padding: 10px 15px; /* Slightly less horizontal padding for icon buttons */
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            height: auto;
            margin: 0;
            transition: background-color 0.2s ease, transform 0.1s ease, border-color 0.2s ease, color 0.2s ease;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px; /* Space between icon and text */
            line-height: 1; /* Prevent extra space from line height */
        }

        .controls button svg {
            width: var(--control-icon-size);
            height: var(--control-icon-size);
            fill: currentColor;
        }

        .controls button:hover {
             transform: translateY(-1px);
        }
        .controls button:active {
             transform: translateY(0);
        }

        /* Call Button */
        #call-peer {
            background-color: var(--accent-purple);
        }
        #call-peer:hover {
            background-color: var(--accent-purple-hover);
        }

        /* Media Control Buttons (Camera, Mic) */
        #toggle-camera, #toggle-mic {
            background-color: var(--background-medium);
            border: 1px solid var(--border-color);
            min-width: 50px; /* Ensure consistent width */
            justify-content: center; /* Center icon */
            padding: 10px; /* Square padding */
        }
        #toggle-camera:hover, #toggle-mic:hover {
            background-color: var(--background-light);
            border-color: var(--text-secondary);
        }

        /* Specific 'Off' state for media buttons */
        #toggle-camera.off, #toggle-mic.off {
            background-color: var(--red-leave);
            border-color: var(--red-leave);
            color: var(--text-primary); /* Keep icon white on red bg */
        }
        #toggle-camera.off:hover, #toggle-mic.off:hover {
            background-color: var(--red-leave-hover);
            border-color: var(--red-leave-hover);
        }

        /* Hide irrelevant icons based on state */
        #toggle-camera .icon-on,
        #toggle-mic .icon-on { display: inline-block; } /* Default visible */
        #toggle-camera .icon-off,
        #toggle-mic .icon-off { display: none; } /* Default hidden */

        #toggle-camera.off .icon-on,
        #toggle-mic.off .icon-on { display: none; } /* Hide 'on' icon when off */
        #toggle-camera.off .icon-off,
        #toggle-mic.off .icon-off { display: inline-block; } /* Show 'off' icon when off */


        /* Share Screen Button - Adjust styling if needed */
        #shareScreen {
            background-color: var(--background-medium);
            border: 1px solid var(--border-color);
        }
        #shareScreen:hover {
            background-color: var(--background-light);
            border-color: var(--text-secondary);
        }

        /* Footer Styling */
        footer {
            background-color: var(--background-dark);
            color: var(--text-secondary);
            padding: 12px;
            text-align: center;
            font-family: 'Noto Sans Oriya', sans-serif;
            font-size: 0.9em;
            height: auto;
            border-top: 1px solid var(--background-light);
            text-decoration: none;
        }

        footer a {
            color: var(--accent-purple);
            text-decoration: none;
            font: bold 12px/1.1 "Noto Sans Oriya", sans-serif;

        }

        footer a:hover {
            text-decoration: none;
            outline: none;
    box-shadow: none;
    color:#ccaf2e ;
    text-decoration: none;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .navbar {
                padding: 10px 15px;
            }
            .peer-id-container {
                 gap: 5px;
            }
            h3#show-peer {
                max-width: 290px; /* Adjust max width */
                 font-size: 0.8em;
                 padding: 6px 8px;
            }
             #copy-peer-id svg {
                 width: calc(var(--copy-icon-size) * 0.9);
                 height: calc(var(--copy-icon-size) * 0.9);
            }

            #ourVideo {
                width: 120px;
                height: 90px;
                top: 15px;
                right: 15px;
            }
            .section1 {
                padding: 15px;
            }
            .controls {
                /* Keep controls in a row, but allow wrapping */
                 padding: 15px;
                 gap: 10px;
            }
            .controls input#peerID {
                max-width: 180px; /* Adjust input width */
                 flex-grow: 0; /* Don't let it grow too much */
            }
             .controls button {
                 font-size: 0.85em;
                 padding: 8px 12px;
                 gap: 5px;
            }
             #toggle-camera, #toggle-mic {
                 padding: 8px;
                 min-width: 40px;
            }
             .controls button svg {
                 width: calc(var(--control-icon-size) * 0.9);
                 height: calc(var(--control-icon-size) * 0.9);
            }
        }

        @media (max-width: 480px) {
            .navbar {
                flex-direction: column; /* Stack peer id and hidden video placeholder */
                align-items: flex-start;
                gap: 5px;
            }
            .peer-id-container {
                 width: 100%; /* Take full width */
            }
             h3#show-peer {
                 max-width: none; /* Allow full width */
                 flex-grow: 1;
             }
            #ourVideo {
                width: 90px;
                height: 67px;
                top: 10px;
                right: 10px;
            }

             .controls {
                justify-content: space-around; /* Better spacing */
            }
            .controls input#peerID {
                flex-basis: 100%; /* Make input take full width on its own line */
                max-width: none;
                order: 1; /* Put input first visually */
            }
             #call-peer {
                 order: 2; /* Call button next */
                 flex-grow: 1; /* Allow call button to grow */
             }
             #toggle-mic, #toggle-camera, #shareScreen {
                 order: 3; /* Other controls last */
             }
        }
        .lang-btn {
    background: none;
    border: none;
    color: inherit;
    font: bold 16px/1.5 "Noto Sans Oriya", sans-serif;
    cursor: pointer;
    text-decoration: none;
    outline: none;
    padding: 5px 10px;
    display: inline-block;
}

.lang-btn:focus {
    outline: none;
    box-shadow: none;
}
.lang-btn:hover {
    outline: none;
    box-shadow: none;
    color:#cc872e ;
    text-decoration: none;
}
.lang-btn1 {
    background: none;
    border: none;
    color: #552ecc;
    font: bold 16px/1.5 "Noto Sans Oriya", sans-serif;
    cursor: pointer;
    text-decoration: none;
    outline: none;
    padding: 5px 10px;
    display: inline-block;
    transition: color 0.5s ease;
}

.lang-btn1:focus {
    outline: none;
    box-shadow: none;

}
.lang-btn1:hover {
    outline: none;
    box-shadow: none;
    color:inherit ;
    text-decoration: none;
}

    </style>
</head>

<body>
    <div id="app-content"> <!-- App content wrapper - visible by default -->
        <nav class="navbar">

            <!-- Peer ID and Copy Button Container -->
            <div class="peer-id-container">
                <h3 id="show-peer"> Getting Unique SB ID....   </h3>
                <button id="copy-peer-id" title="Copy SB ID">
                    <!-- Default Copy Icon -->
                    <svg class="icon-copy" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2Zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6ZM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2Z"/>
                    </svg>
                     <!-- Checkmark Icon (shown after copy) -->
                     <svg class="icon-copied" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                         <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
                     </svg>
                </button>
            </div>

            <!-- This div is just a placeholder in the flex layout for the absolutely positioned video -->
            <div class="video1">
                <div id="ourVideo">
                    <!-- Local video added here by JS -->
                </div>
            </div>
        </nav>

        <section class="section1">
            <div id="remoteVideo">
                <!-- Remote video added here by JS -->
            </div>
        </section>

        <div class="controls"> <!-- Renamed class from btn to controls -->
            <input id="peerID" placeholder="Enter SB ID">
            <button id="call-peer">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone-fill" viewBox="0 0 16 16">
                     <path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
                 </svg>
                Connect
            </button>

            <!-- Mute/Unmute Button -->
            <button id="toggle-mic" title="Mute/Unmute Microphone">
                <!-- Mic On Icon -->
                <svg class="icon-on" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-mic-fill" viewBox="0 0 16 16">
                    <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"/>
                    <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
                </svg>
                 <!-- Mic Off Icon -->
                 <svg class="icon-off" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-mic-mute-fill" viewBox="0 0 16 16">
                     <path d="M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4.02 4.02 0 0 0 12 8V7a.5.5 0 0 1 1 0v1zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a4.973 4.973 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4zm3.646-7.354l-8 8a.5.5 0 0 0 .708.708l8-8a.5.5 0 0 0-.708-.708z"/>
                     <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-.13.877l-1.684-1.683A3.002 3.002 0 0 1 11 8V3a2 2 0 0 0-4 0v.123l.612.611A3.01 3.01 0 0 1 8 3a2 2 0 0 0-1.848 1.214L5 5.123V3z"/>
                 </svg>
            </button>

            <!-- Camera On/Off Button -->
            <button id="toggle-camera" title="Turn Camera On/Off">
                 <!-- Camera On Icon -->
                 <svg class="icon-on" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video-fill" viewBox="0 0 16 16">
                     <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A.5.5 0 0 1 15 3.5v9a.5.5 0 0 1-.407.498l-3.11-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"/>
                 </svg>
                 <!-- Camera Off Icon -->
                 <svg class="icon-off" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video-off-fill" viewBox="0 0 16 16">
                     <path fill-rule="evenodd" d="M10.961 12.365a1.99 1.99 0 0 0 .522-1.103l3.11 1.382A.5.5 0 0 0 15 12.197V3.803a.5.5 0 0 0-.407-.498l-3.11 1.382A2 2 0 0 0 9.5 3H4.272l6.69 9.365z"/>
                     <path d="M2.41 1.033a.5.5 0 0 0-.683-.066L.379 2.68A.5.5 0 0 0 .173 3H.5a.5.5 0 0 0 .5.5v7a.5.5 0 0 0 .5.5h6.472L11.59 15.4a.5.5 0 0 0 .825-.37l.02-.002.442-1.106a.5.5 0 0 0-.066-.683L2.41 1.033z"/>
                 </svg>
            </button>

            <!-- Share Screen Button (kept original structure) -->
            <button id="shareScreen" title="Screen Share">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-display-fill" viewBox="0 0 16 16">
                    <path d="M5.75 13.5c.167-.333.25-.833.25-1.5h4c0 .667.083 1.167.25 1.5H11a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1h.75z"/>
                    <path d="M13.991 3H2c-.325 0-.502.078-.602.145a.758.758 0 0 0-.254.338c-.068.14-.073.341-.073.517v6c0 .176.005.377.073.517.048.104.14.234.254.338.1.067.277.145.602.145h11.991c.325 0 .502-.078.602-.145a.758.758 0 0 0 .254-.338c.068-.14.073-.341-.073-.517v-6c0-.176-.005-.377-.073-.517a.758.758 0 0 0-.254-.338C14.493 3.078 14.316 3 13.991 3z"/>
                </svg>
                 Share Screen
            </button>
        </div>


        <footer class="down">© 2019-25 <a href="http://instagram.com/sandeepbiswalg/">Sandeep Biswal G </a> | Version 1.9   <div class="language-switcher">
            <a href="#" class="lang-btn1">English</a>
            <a href="/od" class="lang-btn">ଓଡ଼ିଆ</a>
        </div></footer>
    </div> <!-- End #app-content -->

    <div id="restriction-message" style="display: none; text-align: center; padding: 50px; color: white; font-size: 1.2em;">
        <!-- Message will be set by JavaScript -->
    </div>

<script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
<script>
    // Declare peer, myStream, and currentPeerConnection in a scope accessible by both initializeApp and performGeoIPCheck
    let peer = null;
    let myStream = null;
    let currentPeerConnection = null; // Used to store the RTCPeerConnection for active call

    // Function to initialize the main PeerJS app
    function initializeApp() {
        const showPeerElement = document.getElementById("show-peer");
        const copyPeerIdButton = document.getElementById("copy-peer-id");
        const copyIcon = copyPeerIdButton ? copyPeerIdButton.querySelector('.icon-copy') : null;
        const copiedIcon = copyPeerIdButton ? copyPeerIdButton.querySelector('.icon-copied') : null;
        const peerIdInput = document.getElementById("peerID");
        const callButton = document.getElementById("call-peer");
        const shareScreenButton = document.getElementById("shareScreen");
        const toggleMicButton = document.getElementById("toggle-mic");
        const toggleCameraButton = document.getElementById("toggle-camera");
        const ourVideoContainer = document.getElementById("ourVideo");
        const remoteVideoContainer = document.getElementById("remoteVideo");

        let peerList = [];
        let isMicMuted = false;
        let isCameraOff = false;

        peer = new Peer(); // Initialize the higher-scoped peer

        peer.on('open', function (id) {
            if (showPeerElement) {
                showPeerElement.innerHTML = id;
                showPeerElement.title = id;
            }
            if (copyPeerIdButton) copyPeerIdButton.disabled = false;
        });

        peer.on('call', function (call) {
            navigator.mediaDevices.getUserMedia({
                video: true,
                audio: true
            }).then((stream) => {
                myStream = stream; // Assign to higher-scoped myStream
                addOurVideo(myStream);
                updateMediaButtonStates();

                call.answer(myStream);

                call.on('stream', function (remoteStream) {
                    if (!peerList.includes(call.peer)) {
                        addRemoteVideo(remoteStream);
                        currentPeerConnection = call.peerConnection; // Store RTCPeerConnection
                        peerList.push(call.peer);
                        console.log("Connected to SB ID:", call.peer);
                    }
                });

                call.on('close', () => {
                    console.log("Call closed by remote peer:", call.peer);
                    removeRemoteVideo();
                    if (currentPeerConnection === call.peerConnection) currentPeerConnection = null;
                    peerList = peerList.filter(p => p !== call.peer);
                });

                call.on('error', (err) => {
                     console.error("Peer (SB ID) call error:", err);
                     removeRemoteVideo();
                     if (currentPeerConnection === call.peerConnection) currentPeerConnection = null;
                     peerList = peerList.filter(p => p !== call.peer);
                });

            }).catch((err) => {
                console.error("Failed to get local stream", err);
                if (document.getElementById('app-content').style.display !== 'none') {
                    // alert("Could not access camera/microphone. Please check permissions.");
                }
            });
        });

        peer.on('error', (err) => {
            console.error("PeerJS error:", err);
            const appIsVisible = document.getElementById('app-content').style.display !== 'none';
            if (appIsVisible) {
                if (err.type === 'unavailable-id') {
                     if (peerIdInput) alert(`SB ID "${peerIdInput.value}" is unavailable.`);
                } else if (err.type === 'peer-unavailable') {
                     if (peerIdInput) alert(`Could not connect to SB ID "${peerIdInput.value}". Please ensure it's correct and the user is online.`);
                } else {
                     // alert("An error occurred with the connection: " + err.message);
                }
            }
             if (showPeerElement && peer && peer.id) {
                showPeerElement.innerHTML = peer.id;
             } else if (showPeerElement) {
                showPeerElement.innerHTML = "Error, Refresh";
             }
        });

        // --- Event Listeners ---
        if (copyPeerIdButton) {
            copyPeerIdButton.addEventListener('click', () => {
                if (!showPeerElement || !copyIcon || !copiedIcon) return;
                const peerId = showPeerElement.innerText;
                if (peerId && peerId !== " Getting Unique SB ID....   ") {
                    navigator.clipboard.writeText(peerId).then(() => {
                        copyIcon.style.display = 'none';
                        copiedIcon.style.display = 'inline-block';
                        copyPeerIdButton.title = "Copied!";
                        setTimeout(() => {
                            copyIcon.style.display = 'inline-block';
                            copiedIcon.style.display = 'none';
                            copyPeerIdButton.title = "Copy SB ID";
                        }, 1500);
                    }).catch(err => {
                        console.error('Failed to copy SB ID: ', err);
                        if (document.getElementById('app-content').style.display !== 'none') {
                           alert("Failed to copy ID. You might need to enable clipboard permissions.");
                        }
                    });
                }
            });
        }

        if (callButton) {
            callButton.addEventListener('click', () => {
                if (!peerIdInput) return;
                const remotePeerId = peerIdInput.value.trim();
                if (!remotePeerId) {
                    if (document.getElementById('app-content').style.display !== 'none') alert("Please enter a SB ID to call.");
                    return;
                }
                if (peer && remotePeerId === peer.id) {
                     if (document.getElementById('app-content').style.display !== 'none') alert("You cannot call yourself.");
                     return;
                }
                console.log(`Calling to SB ID : ${remotePeerId}`);
                if (showPeerElement) {
                    showPeerElement.title = `Connecting to ${remotePeerId}...`;
                    showPeerElement.innerHTML = `Connecting...`;
                }
                callPeer(remotePeerId);
            });
        }

        if (shareScreenButton) {
            shareScreenButton.addEventListener('click', () => {
                 if (!currentPeerConnection) {
                     if (document.getElementById('app-content').style.display !== 'none') alert("You must be in a call to share your screen.");
                     return;
                 }
                navigator.mediaDevices.getDisplayMedia({
                    video: { cursor: "always" },
                    audio: { echoCancellation: true, noiseSuppression: true, sampleRate: 44100 }
                }).then((stream) => {
                    const videoTrack = stream.getVideoTracks()[0];
                    const audioTrack = stream.getAudioTracks()[0];
                    let videoSender = currentPeerConnection.getSenders().find(s => s.track && s.track.kind === 'video');
                    if (videoSender) videoSender.replaceTrack(videoTrack);
                    else console.warn("No video sender found to replace.");

                     if (audioTrack) {
                         let audioSender = currentPeerConnection.getSenders().find(s => s.track && s.track.kind === 'audio');
                         if (audioSender) audioSender.replaceTrack(audioTrack);
                         else console.warn("No audio sender found to replace for screen share audio.");
                     }
                    videoTrack.onended = () => {
                        stopScreenShare();
                        if (audioTrack) audioTrack.stop();
                    };
                    if (audioTrack) audioTrack.onended = () => stopScreenShare();
                }).catch((err) => {
                    console.error("Unable to get display media", err);
                    if (document.getElementById('app-content').style.display !== 'none') alert("Could not start screen sharing. Error: " + err.message);
                    stopScreenShare();
                });
            });
        }

        if (toggleMicButton) {
            toggleMicButton.addEventListener('click', () => {
                if (!myStream) return;
                const audioTracks = myStream.getAudioTracks();
                if (audioTracks.length > 0) {
                    isMicMuted = !isMicMuted;
                    audioTracks[0].enabled = !isMicMuted;
                    updateMediaButtonStates();
                    console.log(`Microphone ${isMicMuted ? 'Muted' : 'Unmuted'}`);
                } else console.warn("No audio track found in local stream to toggle.");
            });
        }
        if (toggleCameraButton) {
            toggleCameraButton.addEventListener('click', () => {
                if (!myStream) return;
                const videoTracks = myStream.getVideoTracks();
                if (videoTracks.length > 0) {
                    isCameraOff = !isCameraOff;
                    videoTracks[0].enabled = !isCameraOff;
                    updateMediaButtonStates();
                    if (ourVideoContainer) ourVideoContainer.classList.toggle('camera-off', isCameraOff);
                    console.log(`Camera ${isCameraOff ? 'Off' : 'On'}`);
                } else console.warn("No video track found in local stream to toggle.");
            });
        }


        // --- Helper Functions ---
        function callPeer(id) {
            navigator.mediaDevices.getUserMedia({ video: true, audio: true })
            .then((stream) => {
                myStream = stream;
                addOurVideo(myStream);
                updateMediaButtonStates();
                console.log(`Initiating call to ${id}`);
                if (!peer) {
                    console.error("Peer object not initialized before calling.");
                    return;
                }
                const call = peer.call(id, myStream);
                call.on('stream', function (remoteStream) {
                    if (!peerList.includes(call.peer)) {
                        addRemoteVideo(remoteStream);
                        currentPeerConnection = call.peerConnection;
                        peerList.push(call.peer);
                        if (showPeerElement && peer && peer.id) {
                            showPeerElement.innerHTML = peer.id;
                            showPeerElement.title = peer.id;
                        }
                        console.log("Connected to SB ID:", call.peer);
                    }
                });
                call.on('close', () => {
                     console.log("Call closed:", call.peer);
                     removeRemoteVideo();
                     if (currentPeerConnection === call.peerConnection) currentPeerConnection = null;
                     peerList = peerList.filter(p => p !== call.peer);
                     if (showPeerElement && peer && peer.id) showPeerElement.innerHTML = peer.id;
                });
                call.on('error', (err) => {
                      console.error("SB ID call error:", err);
                      removeRemoteVideo();
                      if (currentPeerConnection === call.peerConnection) currentPeerConnection = null;
                      peerList = peerList.filter(p => p !== call.peer);
                      if (showPeerElement && peer && peer.id) showPeerElement.innerHTML = peer.id;
                      if (document.getElementById('app-content').style.display !== 'none') alert("Call failed: " + err.message);
                });
            }).catch((err) => {
                console.error("Failed to get local stream for calling", err);
                if (document.getElementById('app-content').style.display !== 'none') {
                    // alert("Could not access camera/microphone to make the call. Please check permissions.");
                }
                if (showPeerElement && peer && peer.id) showPeerElement.innerHTML = peer.id;
            });
        }

        function stopScreenShare() {
            if (!myStream || !currentPeerConnection) {
                 console.log("Not currently sharing or no active call.");
                 return;
            }
             console.log("Stopping screen share and reverting to camera.");
             navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                 .then(originalStream => {
                     const videoTrack = originalStream.getVideoTracks()[0];
                     const audioTrack = originalStream.getAudioTracks()[0];
                     let videoSender = currentPeerConnection.getSenders().find(s => s.track && s.track.kind === 'video');
                     if (videoSender && videoTrack) videoSender.replaceTrack(videoTrack);
                     else console.warn("Could not find video sender or camera track to revert.");

                     let audioSender = currentPeerConnection.getSenders().find(s => s.track && s.track.kind === 'audio');
                     if (audioSender && audioTrack) audioSender.replaceTrack(audioTrack);
                     else console.warn("Could not find audio sender or mic track to revert.");

                      myStream.getTracks().forEach(track => track.stop()); // Stop old screen share tracks
                      myStream = originalStream; // Replace with original camera/mic stream
                       if (myStream.getAudioTracks().length > 0) myStream.getAudioTracks()[0].enabled = !isMicMuted;
                       if (myStream.getVideoTracks().length > 0) myStream.getVideoTracks()[0].enabled = !isCameraOff;

                       const localVideo = ourVideoContainer ? ourVideoContainer.querySelector('.ourvideo') : null;
                       if (localVideo) localVideo.srcObject = myStream;
                 })
                 .catch(err => {
                     console.error("Failed to get camera stream to revert screen share:", err);
                     if (document.getElementById('app-content').style.display !== 'none') alert("Could not switch back to camera after screen share.");
                     // Attempt to stop the screen share track anyway
                     let videoSender = currentPeerConnection.getSenders().find(s => s.track && s.track.kind === 'video');
                     if (videoSender && videoSender.track) videoSender.track.stop();
                     let audioSender = currentPeerConnection.getSenders().find(s => s.track && s.track.kind === 'audio');
                     if (audioSender && audioSender.track && audioSender.track.label.toLowerCase().includes('screen')) audioSender.track.stop();
                 });
        }

        function addRemoteVideo(stream) {
            if (!remoteVideoContainer) return;
            removeRemoteVideo(); // Clear previous one
            const video = document.createElement("video");
            video.classList.add("video");
            video.srcObject = stream;
            video.autoplay = true;
            video.playsInline = true;
            video.play().catch(e => console.error("Remote video play failed:", e));
            remoteVideoContainer.append(video);
        }

        function removeRemoteVideo() {
             if (!remoteVideoContainer) return;
             const remoteVideo = remoteVideoContainer.querySelector('.video');
             if (remoteVideo) {
                 if (remoteVideo.srcObject) remoteVideo.srcObject.getTracks().forEach(track => track.stop());
                 remoteVideo.remove();
                 console.log("Remote video removed.");
             }
        }

        function addOurVideo(stream) {
            if (!ourVideoContainer) return;
            const existingVideo = ourVideoContainer.querySelector('.ourvideo');
            if (existingVideo) {
                if (existingVideo.srcObject) existingVideo.srcObject.getTracks().forEach(track => track.stop());
                existingVideo.remove();
            }
            const video = document.createElement("video");
            video.classList.add("ourvideo");
            video.srcObject = stream;
            video.muted = true;
            video.playsInline = true;
            video.autoplay = true;
            video.play().catch(e => console.error("Local video play failed:", e));
            ourVideoContainer.append(video);
            ourVideoContainer.classList.remove('camera-off');
        }

        function updateMediaButtonStates() {
            if (toggleMicButton) {
                if (isMicMuted) {
                    toggleMicButton.classList.add('off');
                    toggleMicButton.title = "Unmute Microphone";
                } else {
                    toggleMicButton.classList.remove('off');
                    toggleMicButton.title = "Mute Microphone";
                }
            }
            if (toggleCameraButton) {
                if (isCameraOff) {
                    toggleCameraButton.classList.add('off');
                    toggleCameraButton.title = "Turn Camera On";
                } else {
                    toggleCameraButton.classList.remove('off');
                    toggleCameraButton.title = "Turn Camera Off";
                }
            }
             const hasStream = !!myStream;
             if (toggleMicButton) toggleMicButton.disabled = !hasStream;
             if (toggleCameraButton) toggleCameraButton.disabled = !hasStream;
             if (shareScreenButton) shareScreenButton.disabled = !hasStream || !currentPeerConnection;
        }

        if (copyPeerIdButton) copyPeerIdButton.disabled = true;
        updateMediaButtonStates(); // Initial state for media buttons
    } // END OF initializeApp() function


    window.addEventListener('load', (event) => {
        const appContent = document.getElementById('app-content');
        const restrictionMessageElement = document.getElementById('restriction-message');

        if (restrictionMessageElement) restrictionMessageElement.style.display = 'none';
        initializeApp(); // Initialize the app immediately

        // --- Perform GeoIP check in the background ---
        const restrictedCountryCode = ['PK', 'CN', 'TR', 'IN'];
        const restrictionText = 'Sorry, SB Video Call is currently unavailable in your country.';

        async function performGeoIPCheck() {
            try {
                const fetchTimeout = (url, ms, { signal, ...options } = {}) => {
                    const controller = new AbortController();
                    const promise = fetch(url, { signal: controller.signal, ...options });
                    if (signal) signal.addEventListener("abort", () => controller.abort());
                    const timeout = setTimeout(() => controller.abort(), ms);
                    return promise.finally(() => clearTimeout(timeout));
                };

                // Using a more resilient API endpoint if ip-api.com has issues with http
                // const response = await fetchTimeout('https://ipapi.co/json/', 5000);
                // Fallback to ip-api.com if needed, ensure it's accessible via HTTPS if possible
                // Or use a different service that's reliable and supports HTTPS.
                // For ip-api.com, free tier is HTTP only. Consider proxying or a paid plan for HTTPS.
                // Sticking with http for ip-api.com based on previous examples, but be aware of mixed content if your site is HTTPS.
                const response = await fetchTimeout('http://ip-api.com/json/?fields=status,message,countryCode', 5000); // 5 second timeout

                if (!response.ok) {
                    if (response.status === 0) {
                         console.warn('GeoIP API request may have timed out or been blocked (CORS/mixed content).');
                    } else {
                         throw new Error(`GeoIP API error! status: ${response.status}`);
                    }
                    return; // Don't proceed if response not ok and not timed out
                }
                const data = await response.json();

                if (data.status === 'success' && data.countryCode) {
                    console.log('User country code:', data.countryCode);
                    if (data.countryCode === restrictedCountryCode) {
                        if (appContent) appContent.style.display = 'none';
                        if (restrictionMessageElement) {
                            restrictionMessageElement.textContent = restrictionText;
                            restrictionMessageElement.style.display = 'block';
                        }
                        console.log("Access restricted for country:", data.countryCode);

                        // Attempt to cleanup PeerJS resources
                        if (peer && typeof peer.destroy === 'function') {
                            peer.destroy();
                            peer = null;
                            console.log("PeerJS instance destroyed due to restriction.");
                        }
                        if (myStream && typeof myStream.getTracks === 'function') {
                            myStream.getTracks().forEach(track => track.stop());
                            myStream = null;
                            console.log("Local media streams stopped due to restriction.");
                        }
                        if (currentPeerConnection && typeof currentPeerConnection.close === 'function') {
                            currentPeerConnection.close();
                            currentPeerConnection = null;
                            console.log("RTCPeerConnection closed due to restriction.");
                        }
                        const ourVideoContainer = document.getElementById("ourVideo");
                        const remoteVideoContainer = document.getElementById("remoteVideo");
                        if (ourVideoContainer) ourVideoContainer.innerHTML = '';
                        if (remoteVideoContainer) remoteVideoContainer.innerHTML = '';
                    } else {
                        console.log("Access allowed for country:", data.countryCode);
                    }
                } else {
                    console.warn('Could not determine country from GeoIP API:', data.message, "Defaulting to allowed.");
                }
            } catch (error) {
                console.error('Error during GeoIP check:', error, "Defaulting to allowed.");
            }
        }
        performGeoIPCheck();
    });
</script>
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/sw.js')
        .then(function(registration) {
          console.log('ServiceWorker registered with scope:', registration.scope);
        }, function(error) {
          console.log('ServiceWorker registration failed:', error);
        });
    });
  }
</script>
<script>
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    setTimeout(() => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the install prompt');
          } else {
            console.log('User dismissed the install prompt');
          }
          deferredPrompt = null;
        });
      }
    }, 3000);
  });
</script>
<!--
  WARNING: Do not download, sell, or distribute the SB Video Call Web App.
  This project is free and cannot be copied or sold.
  Unauthorized use, reproduction, or distribution is illegal and violates the terms of use.
  Respect the developers' work and ensure the app is used responsibly and ethically.
  instagram me @sandeepbiswlg
-->
</html>
